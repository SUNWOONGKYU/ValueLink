# S5T1: Testing & QA (신규 구현)

## Task 정보

- **Task ID**: S5T1
- **Task Name**: 통합 테스트 및 품질 보증
- **Stage**: S5 (Finalization - 개발 마무리)
- **Area**: T (Testing)
- **Dependencies**: 모든 S2-S4 Task 완료
- **Task Agent**: test-engineer
- **Verification Agent**: qa-specialist

---

## Task 목표

**14단계 평가 워크플로우 통합 테스트 + E2E 사용자 시나리오 테스트 + 테스트 리포트 작성**

- Jest 기반 통합 테스트 (14단계 워크플로우)
- Playwright 기반 E2E 테스트 (3개 사용자 여정)
- 테스트 리포트 문서화

---

## 🎯 개선 필수 영역

### 1️⃣ 테스트 커버리지 (목표: 80%)
- ✅ 14단계 워크플로우 전체 커버
- ✅ 3개 역할별 사용자 여정 (고객, 회계사, 관리자)
- ✅ 엣지 케이스 포함

### 2️⃣ 테스트 격리
- ✅ 각 테스트 독립 실행 가능
- ✅ afterAll()에서 테스트 데이터 정리
- ✅ 테스트 간 상태 공유 최소화

### 3️⃣ 테스트 실용성
- ✅ 실제 Supabase DB 연동 테스트
- ✅ 평가 엔진 수학적 정확성 검증
- ✅ 크롤러 실행 검증

---

## 상세 지시사항

### 1. 통합 테스트: 14단계 평가 워크플로우

**파일**: `tests/integration/valuation-workflow.test.ts`

**테스트 구성 (7개 describe, 18개 test):**

| # | 구간 | describe | test 수 |
|---|------|----------|---------|
| 1 | Step 1-3 | 프로젝트 생성 및 견적 | 3 |
| 2 | Step 4-6 | 협상 및 계약 | 2 |
| 3 | Step 7-9 | 서류 업로드 및 검토 | 2 |
| 4 | Step 10 | DCF 평가 엔진 실행 | 2 |
| 5 | Step 11-12 | 초안 생성 및 수정 | 2 |
| 6 | Step 13 | 최종 보고서 생성 | 1 |
| 7 | Step 14 | 프로젝트 완료 | 2 |

**핵심:**
- `beforeAll()`: 테스트 프로젝트 생성
- `afterAll()`: 테스트 데이터 정리
- Supabase 실제 DB 연동
- ValuationOrchestrator 실행

---

### 2. E2E 테스트: 사용자 여정

**파일**: `tests/e2e/user-journey.test.ts`

**테스트 구성 (3개 describe):**

| # | 역할 | 시나리오 | 단계 |
|---|------|---------|------|
| 1 | 고객 | 로그인 → 프로젝트 생성 → 견적 → 서류 → 초안 확인 | 6단계 |
| 2 | 회계사 | 로그인 → 프로젝트 확인 → 서류 검토 → 평가 결과 입력 | 4단계 |
| 3 | 관리자 | 로그인 → 프로젝트 목록 → 통계 확인 | 3단계 |

**Playwright 설정:**
- 헤드리스 모드
- 로컬 서버 (localhost:3000)
- 테스트 계정 사용

---

### 3. 테스트 리포트

**파일**: `docs/test-report.md`

**포함 내용:**
- 테스트 개요 (프로젝트명, 일자, 범위)
- 결과 요약 (통합 18개 + E2E 3개 = 21개)
- 통합 테스트 상세 (7개 구간별)
- E2E 테스트 상세 (3개 역할별)
- 코드 커버리지 (목표 85%)
- 성능 테스트 (페이지 로드, API 응답, DCF 실행)
- 발견된 이슈 (Critical/Major/Minor)
- 권장 사항

---

## 생성 파일

| # | 파일 | 설명 | 라인 수 |
|---|------|------|--------|
| 1 | `tests/integration/valuation-workflow.test.ts` | 통합 테스트 | ~250줄 |
| 2 | `tests/e2e/user-journey.test.ts` | E2E 테스트 | ~150줄 |
| 3 | `docs/test-report.md` | 테스트 리포트 | ~280줄 |

**총 파일 수**: 3개
**총 라인 수**: ~680줄

---

## 기술 스택

- **Jest**: 통합 테스트 프레임워크
- **Playwright**: E2E 테스트 프레임워크
- **Supabase**: 테스트 데이터베이스 (실제 DB)
- **Testing Library**: React 컴포넌트 테스트 (향후)

---

## 완료 기준

### 필수 (Must Have)
- [ ] 통합 테스트 18개 작성
- [ ] E2E 테스트 3개 작성
- [ ] 테스트 리포트 작성
- [ ] 모든 테스트 통과
- [ ] 코드 커버리지 80% 이상

### 검증 (Verification)
- [ ] `npm run test` 실행 성공
- [ ] `npm run test:e2e` 실행 성공
- [ ] 커버리지 리포트 생성 확인

---

## 주의사항

1. **테스트 데이터 정리**: `afterAll()`에서 반드시 삭제
2. **비동기 처리**: `async/await` 일관성, 타임아웃 설정
3. **E2E 환경**: Playwright 브라우저 자동 설치, 헤드리스 모드
4. **테스트 격리**: 각 테스트 독립 실행, 순서 의존성 없음
5. **커버리지 목표**: 최소 80%, Critical 경로 100%

---

**작성일**: 2026-02-08 (REVISED)
**작성자**: Claude Code (Opus 4.6)
**수정 이유**: 신규 구현 방식으로 정리, 테스트 구조 명확화
